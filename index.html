<!DOCTYPE html>
<html>
    <head>
        <style>
            @font-face {
                font-family: "meslo";
                src: url("font/MesloLGM-Italic.ttf") format("truetype");
                font-weight: normal;
                font-style: italic;
            }
            @font-face {
                font-family: "meslo";
                src: url("font/MesloLGM-Regular.ttf") format("truetype");
                font-weight: normal;
                font-style: normal;
            }
            @font-face {
                font-family: "meslo";
                src: url("font/MesloLGM-Bold.ttf") format("truetype");
                font-weight: bold;
                font-style: normal;
            }
            @font-face {
                font-family: "meslo";
                src: url("font/MesloLGM-BoldItalic.ttf") format("truetype");
                font-weight: bold;
                font-style: italic;
            }
        </style>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/diff/dist/diff.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/github.min.css" />
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui-slim.min.js"></script>

        <link
            rel="stylesheet"
            data-name="vs/editor/editor.main"
            href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.0/min/vs/editor/editor.main.min.css"
        />
		<script>
			var require = { paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.0/min/vs' } };
		</script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.0/min/vs/loader.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.0/min/vs/editor/editor.main.nls.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.0/min/vs/editor/editor.main.min.js"></script>
        
        <script>
            const knyteSpaceApi = {
                knyteMap: {},
                originToLinkMap: {},
                terminationToLinkMap: {},
                bootloaderKnyteId: '2ac04735-106f-4179-aa49-bdbe5e740d77',
                viewportElement: undefined,
            };

            async function onLoad()
            {
                // get bootloader knyte
                const response = await fetch('https://knyte-space.herokuapp.com/knyte/knyteId=' + knyteSpaceApi.bootloaderKnyteId);
                const json = await response.json();
                const bootloaderKnyte = json.result[0];
                // run bootloader code
                const {content} = bootloaderKnyte;
                try
                {
                    const bootloaderFunction = new Function(content);
                    bootloaderFunction();
                }
                catch(e)
                {
                    throw e;
                }

                /*
                knyteSpaceApi.viewportElement = document.getElementById('viewport');
                const response = await fetch('https://knyte-space.herokuapp.com/knytes');
                const json = await response.json();
                const knytes = json.result;
                // build knyte maps
                for (var i = 0; i < knytes.length; ++i)
                {
                    const knyte = knytes[i];
                    knyteSpaceApi.knyteMap[knyte.knyte_id] = knyte;
                    if (knyte.origin_id)
                    {
                        if (!knyteSpaceApi.originToLinkMap[knyte.origin_id])
                            knyteSpaceApi.originToLinkMap[knyte.origin_id] = [];
                        knyteSpaceApi.originToLinkMap[knyte.origin_id].push(knyte.knyte_id);
                    }
                    if (knyte.termination_id)
                    {
                        if (!knyteSpaceApi.terminationToLinkMap[knyte.termination_id])
                            knyteSpaceApi.terminationToLinkMap[knyte.termination_id] = [];
                        knyteSpaceApi.terminationToLinkMap[knyte.termination_id].push(knyte.knyte_id);
                    }
                }
                // run bootloader block
                const {content} = knyteSpaceApi.knyteMap[knyteSpaceApi.bootloaderKnyteId];
                try
                {
                    const bootloaderFunction = new Function(content);
                    bootloaderFunction();
                }
                catch(e)
                {
                    throw e;
                }
                */
            }
        </script>
    </head>
    <body onload="onLoad()">
        <div id="viewport"></div>
    </body>
</html>