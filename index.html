<!DOCTYPE html>
<html>
    <head>
        <style>
            @font-face {
                font-family: "meslo";
                src: url("font/MesloLGM-Italic.ttf") format("truetype");
                font-weight: normal;
                font-style: italic;
            }
            @font-face {
                font-family: "meslo";
                src: url("font/MesloLGM-Regular.ttf") format("truetype");
                font-weight: normal;
                font-style: normal;
            }
            @font-face {
                font-family: "meslo";
                src: url("font/MesloLGM-Bold.ttf") format("truetype");
                font-weight: bold;
                font-style: normal;
            }
            @font-face {
                font-family: "meslo";
                src: url("font/MesloLGM-BoldItalic.ttf") format("truetype");
                font-weight: bold;
                font-style: italic;
            }

            body {
                font-family: meslo;
                margin: 2em;
            }
            pre {
                border: 2px solid black;
                margin: 0.5em;
                padding: 0.5em;
            }
        </style>
        <script>
            async function onLoad()
            {
                const response = await fetch('https://knyte-space.herokuapp.com/knytes');
                const json = await response.json();
                const knytes = json.result;
                const knyteList = document.getElementById('knyteList');
                // show knyte content
                for (var i = 0; i < knytes.length; ++i)
                {
                    const knyte = knytes[i];
                    const knyteElement = document.createElement('pre');
                    knyteElement.id = knyte.knyte_id;
                    knyteElement.textContent = knyte.content;
                    knyteList.appendChild(knyteElement);
                }
                // run knyte content as a peace of js code
                for (var i = 0; i < knytes.length; ++i)
                {
                    const knyte = knytes[i];
                    try
                    {
                        const knyteFunction = new Function(knyte.content);
                        knyteFunction();
                    }
                    catch(e)
                    {
                        const knyteElement = document.getElementById(knyte.knyte_id);
                        knyteElement.style.border = '2px solid red';
                        throw e;
                    }
                }
            }
        </script>
    </head>
    <body onload="onLoad()">
        <div id="knyteList"></div>
    </body>
</html>